-- PlayerModels Bring Script (Mobil Uyumlu, 5s Seçim)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- 1) GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.AnchorPoint = Vector2.new(0.5,0.5)
Frame.Position = UDim2.new(0.5,0,0.85,0)
Frame.Size = UDim2.new(0.4,0,0.12,0)
Frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
Frame.BorderSizePixel = 2

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = Frame
UIListLayout.FillDirection = Enum.FillDirection.Horizontal
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout.Padding = UDim.new(0,10)

local SelectButton = Instance.new("TextButton")
SelectButton.Parent = Frame
SelectButton.Size = UDim2.new(0.45,0,0.8,0)
SelectButton.Text = "Model Seç"
SelectButton.Font = Enum.Font.SourceSansBold
SelectButton.TextSize = 20
SelectButton.BackgroundColor3 = Color3.fromRGB(0,100,255)
SelectButton.TextColor3 = Color3.fromRGB(255,255,255)

local TeleportButton = Instance.new("TextButton")
TeleportButton.Parent = Frame
TeleportButton.Size = UDim2.new(0.45,0,0.8,0)
TeleportButton.Text = "Işınla"
TeleportButton.Font = Enum.Font.SourceSansBold
TeleportButton.TextSize = 20
TeleportButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
TeleportButton.TextColor3 = Color3.fromRGB(255,255,255)

-- 2) Seçim mantığı
local selectedModel = nil
local highlight = nil
local canSelect = false

local function enableSelection()
    canSelect = true
    task.delay(5, function()
        canSelect = false
        if highlight then highlight:Destroy() end
        selectedModel = nil
    end)
end

local function selectModel(model)
    if not canSelect then return end
    if highlight then highlight:Destroy() end

    highlight = Instance.new("SelectionBox")
    highlight.Adornee = model
    highlight.Color3 = Color3.fromRGB(0,0,255)
    highlight.LineThickness = 0.05
    highlight.Parent = model

    selectedModel = model
end

-- 3) PlayerModels içindeki modelleri tıklanabilir yap
local playerModelsFolder = workspace:WaitForChild("PlayerModels")

for _, model in next, playerModelsFolder:GetChildren() do
    if not model:FindFirstChild("ClickDetector") then
        local cd = Instance.new("ClickDetector")
        cd.MaxActivationDistance = 50
        cd.Parent = model
    end
    model.ClickDetector.MouseClick:Connect(function(plr)
        if plr == player then
            selectModel(model)
        end
    end)
end

-- 4) Işınlama fonksiyonu (Ağaç bring mantığı)
local function teleportModel()
    if not selectedModel or not selectedModel.PrimaryPart then return end

    local curPos = player.Character.HumanoidRootPart.CFrame
    player.Character.Humanoid:UnequipTools()
    local model = selectedModel

    local loopConn
    loopConn = RunService.Heartbeat:Connect(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and model:FindFirstChild("PrimaryPart") then
            player.Character.HumanoidRootPart.CFrame = CFrame.new(model.PrimaryPart.Position + Vector3.new(3,0,0), model.PrimaryPart.Position)
        end
    end)

    task.spawn(function()
        local interaction = ReplicatedStorage:FindFirstChild("Interaction")
        if interaction and interaction:FindFirstChild("ClientIsDragging") then
            for i=1,60 do
                interaction.ClientIsDragging:FireServer(model)
                task.wait()
            end
        end
    end)

    local start = model.PrimaryPart.CFrame
    local duration = 1.5
    local elapsed, step = 0, 0.03
    while elapsed < duration do
        local alpha = elapsed/duration
        model.PrimaryPart.CFrame = start:Lerp(curPos,alpha)
        elapsed = elapsed + step
        task.wait(step)
    end

    model.PrimaryPart.CFrame = curPos
    model.PrimaryPart.AssemblyLinearVelocity = Vector3.new(0,0,0)

    if loopConn then loopConn:Disconnect() end
end

-- 5) Butonlar
SelectButton.MouseButton1Click:Connect(enableSelection)
TeleportButton.MouseButton1Click:Connect(teleportModel)
